<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Soups Gallery</title>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- ================================================================
    CSS
  ================================================================ -->
  <style>

    /* ----------------------------------------------------------------
      COLOUR TOKENS
      Edit these to retheme the whole site.
      Dark = default, light = overrides when data-theme="light".
    ---------------------------------------------------------------- */
    :root {
      --bg-base:        #121212;
      --bg-surface:     #1e1e1e;
      --bg-card:        #2a2a2a;
      --bg-input:       #2e2e2e;
      --bg-input-focus: #3a3a3a;
      --bg-btn:         #333;
      --bg-btn-hover:   #444;
      --text-primary:   #fff;
      --text-secondary: #ccc;
      --text-muted:     #888;
      --shadow:         rgba(0,0,0,.5);
      --border:         rgba(255,255,255,.06);
      --accent:         #7eb8f7;        /* main blue accent */
      --accent-dim:     rgba(126,184,247,.15);
    }
    [data-theme="light"] {
      --bg-base:        #f0f0f0;
      --bg-surface:     #e2e2e2;
      --bg-card:        #fff;
      --bg-input:       #dcdcdc;
      --bg-input-focus: #cecece;
      --bg-btn:         #d0d0d0;
      --bg-btn-hover:   #c0c0c0;
      --text-primary:   #111;
      --text-secondary: #333;
      --text-muted:     #666;
      --shadow:         rgba(0,0,0,.15);
      --border:         rgba(0,0,0,.08);
      --accent:         #2b7de9;
      --accent-dim:     rgba(43,125,233,.12);
    }

    /* ----------------------------------------------------------------
      RESET & BASE
    ---------------------------------------------------------------- */
    *, *::before, *::after { box-sizing: border-box; }
    body {
      font-family: 'Fredoka', sans-serif;
      background: var(--bg-base);
      min-height: 100vh;
      color: var(--text-primary);
      margin: 0; padding: 0;
      display: flex; flex-direction: column;
      transition: background .3s, color .3s;
    }

    /* ----------------------------------------------------------------
      HEADER
    ---------------------------------------------------------------- */
    header {
      background: var(--bg-surface);
      padding: 1.2rem 1.5rem;
      font-size: 2.4rem; font-weight: 700;
      display: flex; align-items: center; justify-content: space-between; gap: 1rem;
      border-bottom: 1px solid var(--border);
    }
    .header-title { flex: 1; text-align: center; }
    .theme-toggle {
      background: var(--bg-btn); border: none; border-radius: 50px;
      padding: .4rem 1rem; font-size: 1.2rem; cursor: pointer;
      color: var(--text-primary); font-family: 'Fredoka', sans-serif;
      transition: background .2s;
    }
    .theme-toggle:hover { background: var(--bg-btn-hover); }



    /* ----------------------------------------------------------------
      NAV TABS
    ---------------------------------------------------------------- */
    .nav-tabs {
      display: none;                      /* shown via JS on login */
      background: var(--bg-surface);
      justify-content: center; gap: .4rem;
      padding: .65rem 1rem; flex-wrap: wrap;
      border-bottom: 1px solid var(--border);
    }
    .nav-tabs.visible { display: flex; }
    .nav-tab {
      padding: .5rem 1.2rem; font-size: 1rem; font-family: 'Fredoka', sans-serif;
      background: var(--bg-btn); border: none; border-radius: 8px;
      color: var(--text-secondary); cursor: pointer;
      transition: background .2s, color .2s, transform .15s;
    }
    .nav-tab:hover  { background: var(--bg-btn-hover); color: var(--text-primary); transform: translateY(-2px); }
    .nav-tab.active { background: var(--accent); color: #fff; }

    /* ----------------------------------------------------------------
      PASSWORD GATE
    ---------------------------------------------------------------- */
    .password-section {
      text-align: center; padding: 2.5rem;
      background: var(--bg-card); border-radius: 16px;
      margin: 4rem auto; width: 90%; max-width: 440px;
      box-shadow: 0 8px 32px var(--shadow);
    }
    .password-section h2 { margin: 0 0 .5rem; font-size: 1.8rem; }
    .password-section p  { color: var(--text-muted); margin: 0 0 1.2rem; }
    .password-section input {
      display: block; margin: 0 auto 1rem;
      padding: .9rem 1.2rem; font-size: 1rem; font-family: 'Fredoka', sans-serif;
      border: 2px solid transparent; border-radius: 10px;
      width: 85%; background: var(--bg-input); color: var(--text-primary); outline: none;
      transition: border-color .2s, background .2s;
    }
    .password-section input:focus { border-color: var(--accent); background: var(--bg-input-focus); }
    .pw-btn {
      padding: .9rem 2.5rem; font-size: 1.2rem; font-family: 'Fredoka', sans-serif;
      background: var(--accent); border-radius: 10px; border: none;
      color: #fff; cursor: pointer; transition: opacity .2s, transform .15s;
    }
    .pw-btn:hover { opacity: .85; transform: translateY(-2px); }
    .error-message { background: #c0392b; color: #fff; padding: .8rem; border-radius: 8px; display: none; margin-top: 1rem; }

    /* ----------------------------------------------------------------
      PAGE SHELL  (each tab's content lives in a .page div)
    ---------------------------------------------------------------- */
    .page { display: none; flex: 1; }
    .page.active { display: flex; flex-direction: column; }

    /* ================================================================
      GAMES TAB
    ================================================================ */
    .recently-section { padding: 1.5rem 1.5rem 0; max-width: 1200px; width: 100%; margin: 0 auto; }
    .recently-section h3 { font-size: 1.1rem; color: var(--text-muted); margin: 0 0 .8rem; text-transform: uppercase; letter-spacing: 1px; }
    .recent-strip { display: flex; gap: .8rem; flex-wrap: wrap; }
    .recent-chip {
      background: var(--accent-dim); border: 1px solid var(--accent); color: var(--accent);
      border-radius: 20px; padding: .35rem 1rem; font-size: .9rem;
      font-family: 'Fredoka', sans-serif; text-decoration: none;
      transition: background .2s, transform .15s;
    }
    .recent-chip:hover { background: var(--accent); color: #fff; transform: translateY(-2px); }
    .games-divider { border: none; border-top: 1px solid var(--border); margin: 1.2rem 1.5rem 0; }
    .game-container {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(220px,1fr));
      gap: 1.4rem; margin: 1.4rem 1.5rem;
      max-width: 1200px; width: calc(100% - 3rem); align-self: center;
    }
    .game-card {
      background: var(--bg-card); border-radius: 12px; box-shadow: 0 4px 16px var(--shadow);
      text-align: center; padding: 1.6rem 1rem;
      display: flex; align-items: center; justify-content: center;
      text-decoration: none; color: var(--text-primary); border: 1px solid var(--border);
      transition: transform .25s, box-shadow .25s;
    }
    .game-card:hover { transform: translateY(-8px); box-shadow: 0 10px 28px var(--shadow); }
    .game-card h3 { font-size: 1.3rem; margin: 0; }

    /* ================================================================
      NOTES TAB
    ================================================================ */
    .notes-page { flex: 1; display: flex; gap: 2rem; padding: 1.5rem; max-width: 1600px; width: 100%; margin: 0 auto; }

    /* Left: compose panel */
    .compose-panel { display: flex; flex-direction: column; gap: .8rem; width: 420px; flex-shrink: 0; }
    .compose-panel h2, .notes-panel h2 { margin: 0; font-size: 1.4rem; color: var(--text-secondary); }
    .compose-panel input[type="text"],
    .compose-panel textarea,
    .compose-panel select {
      padding: .75rem 1rem; font-size: .95rem; font-family: 'Fredoka', sans-serif;
      border: 2px solid transparent; border-radius: 8px;
      background: var(--bg-input); color: var(--text-primary); outline: none; width: 100%;
      transition: background .2s, border-color .2s;
    }
    .compose-panel input:focus, .compose-panel textarea:focus, .compose-panel select:focus { background: var(--bg-input-focus); border-color: var(--accent); }
    .compose-panel textarea { resize: vertical; min-height: 280px; line-height: 1.5; }
    .colour-row { display: flex; align-items: center; gap: .5rem; flex-wrap: wrap; }
    .colour-row span { font-size: .9rem; color: var(--text-muted); }
    .colour-dot { width: 24px; height: 24px; border-radius: 50%; cursor: pointer; border: 3px solid transparent; transition: border-color .2s, transform .15s; }
    .colour-dot:hover { transform: scale(1.2); }
    .colour-dot.selected { border-color: var(--text-primary); }
    .notes-save-btn {
      padding: .8rem; font-size: 1.1rem; font-family: 'Fredoka', sans-serif;
      background: var(--accent); border: none; border-radius: 8px; color: #fff;
      cursor: pointer; transition: opacity .2s, transform .15s;
    }
    .notes-save-btn:hover { opacity: .85; transform: translateY(-2px); }

    /* Right: notes grid */
    .notes-panel { flex: 1; display: flex; flex-direction: column; gap: .8rem; }
    .notes-header-row { display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: .5rem; }
    .notes-controls { display: flex; gap: .5rem; flex-wrap: wrap; align-items: center; }
    .search-input, .filter-select {
      padding: .55rem .9rem; font-size: .9rem; font-family: 'Fredoka', sans-serif;
      border: 2px solid transparent; border-radius: 8px;
      background: var(--bg-input); color: var(--text-primary); outline: none;
      transition: background .2s, border-color .2s;
    }
    .search-input { width: 160px; }
    .search-input:focus, .filter-select:focus { background: var(--bg-input-focus); border-color: var(--accent); }
    .notes-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(230px,1fr)); gap: 1rem; }
    .note-card {
      border-radius: 12px; padding: 1rem 1rem .7rem;
      box-shadow: 0 4px 12px rgba(0,0,0,.3);
      display: flex; flex-direction: column; gap: .4rem;
      position: relative; cursor: pointer;
      transition: transform .2s, box-shadow .2s;
    }
    .note-card:hover { transform: translateY(-4px); box-shadow: 0 8px 20px rgba(0,0,0,.35); }
    .note-card.pinned { outline: 2px solid #f5c518; }
    .note-card .card-title   { font-size: 1rem; font-weight: 700; color: rgba(0,0,0,.75); word-break: break-word; padding-left: 1rem; }
    .note-card .card-body    { font-size: .85rem; color: rgba(0,0,0,.6); white-space: pre-wrap; word-break: break-word; flex: 1; }
    .note-card .card-tag     { font-size: .75rem; background: rgba(0,0,0,.15); color: rgba(0,0,0,.6); border-radius: 20px; padding: .1rem .6rem; display: inline-block; width: fit-content; }
    .note-card .card-date    { font-size: .72rem; color: rgba(0,0,0,.4); margin-top: .2rem; }
    .note-card .card-actions { position: absolute; top: .4rem; right: .5rem; display: flex; gap: .25rem; }
    .note-card .card-actions button {
      background: rgba(0,0,0,.15); border: none; border-radius: 6px;
      color: rgba(0,0,0,.55); font-size: .85rem; cursor: pointer;
      padding: .1rem .4rem; font-family: 'Fredoka', sans-serif; transition: background .2s;
    }
    .note-card .card-actions button:hover { background: rgba(0,0,0,.3); }
    .empty-state { color: var(--text-muted); font-size: 1rem; margin-top: 2rem; text-align: center; }

    /* ================================================================
      TO-DO TAB
    ================================================================ */
    .todo-page { flex: 1; max-width: 700px; width: 100%; margin: 1.5rem auto; padding: 0 1.5rem; display: flex; flex-direction: column; gap: 1.2rem; }
    .todo-add-row { display: flex; gap: .6rem; }
    .todo-add-row input {
      flex: 1; padding: .8rem 1rem; font-size: 1rem; font-family: 'Fredoka', sans-serif;
      border: 2px solid transparent; border-radius: 10px;
      background: var(--bg-input); color: var(--text-primary); outline: none;
      transition: background .2s, border-color .2s;
    }
    .todo-add-row input:focus { background: var(--bg-input-focus); border-color: var(--accent); }
    .todo-add-row select { padding: .8rem; font-size: .9rem; font-family: 'Fredoka', sans-serif; border: none; border-radius: 10px; background: var(--bg-input); color: var(--text-primary); cursor: pointer; }
    .todo-add-btn {
      padding: .8rem 1.4rem; font-size: 1.1rem; font-family: 'Fredoka', sans-serif;
      background: var(--accent); border: none; border-radius: 10px; color: #fff;
      cursor: pointer; white-space: nowrap; transition: opacity .2s, transform .15s;
    }
    .todo-add-btn:hover { opacity: .85; transform: translateY(-2px); }
    .todo-filters { display: flex; gap: .5rem; flex-wrap: wrap; }
    .todo-filter-btn { padding: .4rem 1rem; font-size: .9rem; font-family: 'Fredoka', sans-serif; background: var(--bg-btn); border: none; border-radius: 20px; color: var(--text-secondary); cursor: pointer; transition: background .2s, color .2s; }
    .todo-filter-btn:hover  { background: var(--bg-btn-hover); }
    .todo-filter-btn.active { background: var(--accent); color: #fff; }
    .todo-list { display: flex; flex-direction: column; gap: .6rem; }
    @keyframes slideIn { from { opacity:0; transform:translateY(-8px); } to { opacity:1; transform:translateY(0); } }
    .todo-item { display: flex; align-items: center; gap: .8rem; background: var(--bg-card); border-radius: 10px; padding: .8rem 1rem; box-shadow: 0 2px 8px var(--shadow); border: 1px solid var(--border); animation: slideIn .2s ease; }
    .todo-item.done { opacity: .5; }
    .todo-item.done .todo-text { text-decoration: line-through; color: var(--text-muted); }
    .todo-checkbox { width: 20px; height: 20px; border-radius: 6px; border: 2px solid var(--text-muted); background: transparent; cursor: pointer; flex-shrink: 0; display: flex; align-items: center; justify-content: center; font-size: .8rem; transition: background .2s, border-color .2s; }
    .todo-checkbox.checked { background: var(--accent); border-color: var(--accent); }
    .todo-text { flex: 1; font-size: 1rem; }
    .todo-priority { font-size: .75rem; padding: .2rem .6rem; border-radius: 20px; font-weight: 600; flex-shrink: 0; }
    .todo-priority.high   { background: rgba(231,76,60,.2);  color: #e74c3c; }
    .todo-priority.medium { background: rgba(241,196,15,.2); color: #f1c40f; }
    .todo-priority.low    { background: rgba(46,204,113,.2); color: #2ecc71; }
    .todo-del { background: none; border: none; cursor: pointer; color: var(--text-muted); font-size: 1rem; flex-shrink: 0; transition: color .2s, transform .15s; }
    .todo-del:hover { color: #e74c3c; transform: scale(1.2); }
    .todo-clear-btn { align-self: flex-end; padding: .5rem 1.2rem; font-size: .9rem; font-family: 'Fredoka', sans-serif; background: var(--bg-btn); border: none; border-radius: 8px; color: var(--text-muted); cursor: pointer; transition: background .2s, color .2s; }
    .todo-clear-btn:hover { background: rgba(231,76,60,.2); color: #e74c3c; }

    /* ================================================================
      TIMER TAB
    ================================================================ */
    .timer-page { flex: 1; display: flex; flex-direction: column; align-items: center; padding: 2rem 1rem; gap: 2rem; }
    .timer-mode-tabs { display: flex; gap: .5rem; background: var(--bg-card); border-radius: 12px; padding: .4rem; border: 1px solid var(--border); }
    .timer-mode-tab { padding: .5rem 1.4rem; font-size: 1rem; font-family: 'Fredoka', sans-serif; background: none; border: none; border-radius: 8px; color: var(--text-secondary); cursor: pointer; transition: background .2s, color .2s; }
    .timer-mode-tab.active { background: var(--accent); color: #fff; }
    .progress-ring-wrap { position: relative; width: 280px; height: 280px; display: flex; align-items: center; justify-content: center; }
    .progress-ring { position: absolute; top: 0; left: 0; transform: rotate(-90deg); }
    .ring-bg   { fill: none; stroke: var(--border); stroke-width: 12; }
    .ring-fill { fill: none; stroke: var(--accent); stroke-width: 12; stroke-linecap: round; transition: stroke-dashoffset 1s linear; }
    .clock-display { font-size: 6rem; font-weight: 700; letter-spacing: 4px; color: var(--text-primary); font-variant-numeric: tabular-nums; text-align: center; }
    .clock-display.warning { color: #e74c3c; }
    @keyframes pulse { from { opacity:1; } to { opacity:.4; } }
    .clock-display.done { animation: pulse .5s ease infinite alternate; }
    .timer-controls { display: flex; gap: 1rem; }
    .timer-btn { padding: .8rem 2rem; font-size: 1.2rem; font-family: 'Fredoka', sans-serif; background: var(--bg-btn); border: none; border-radius: 12px; color: var(--text-primary); cursor: pointer; min-width: 100px; transition: background .2s, transform .15s; }
    .timer-btn:hover { background: var(--bg-btn-hover); transform: translateY(-2px); }
    .timer-btn.primary { background: var(--accent); color: #fff; }
    .timer-btn.primary:hover { opacity: .85; }
    .pomodoro-presets { display: flex; gap: .6rem; flex-wrap: wrap; justify-content: center; }
    .preset-btn { padding: .45rem 1rem; font-size: .9rem; font-family: 'Fredoka', sans-serif; background: var(--bg-card); border: 1px solid var(--border); border-radius: 20px; color: var(--text-secondary); cursor: pointer; transition: background .2s, color .2s, border-color .2s; }
    .preset-btn:hover { background: var(--accent-dim); color: var(--accent); border-color: var(--accent); }
    .session-counter { color: var(--text-muted); font-size: .95rem; }

    /* ================================================================
      LINKS TAB
    ================================================================ */
    .links-page { flex: 1; max-width: 900px; width: 100%; margin: 1.5rem auto; padding: 0 1.5rem; display: flex; flex-direction: column; gap: 1.4rem; }
    .links-add-form { background: var(--bg-card); border-radius: 14px; padding: 1.4rem; display: flex; gap: .8rem; flex-wrap: wrap; border: 1px solid var(--border); box-shadow: 0 4px 16px var(--shadow); }
    .links-add-form input { flex: 1; min-width: 180px; padding: .75rem 1rem; font-size: .95rem; font-family: 'Fredoka', sans-serif; border: 2px solid transparent; border-radius: 8px; background: var(--bg-input); color: var(--text-primary); outline: none; transition: background .2s, border-color .2s; }
    .links-add-form input:focus { background: var(--bg-input-focus); border-color: var(--accent); }
    .links-add-btn { padding: .75rem 1.6rem; font-size: 1rem; font-family: 'Fredoka', sans-serif; background: var(--accent); border: none; border-radius: 8px; color: #fff; cursor: pointer; white-space: nowrap; transition: opacity .2s, transform .15s; }
    .links-add-btn:hover { opacity: .85; transform: translateY(-2px); }
    .links-header-row { display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: .5rem; }
    .links-header-row h2 { margin: 0; font-size: 1.4rem; color: var(--text-secondary); }
    .links-search { padding: .55rem .9rem; font-size: .9rem; font-family: 'Fredoka', sans-serif; border: 2px solid transparent; border-radius: 8px; width: 180px; background: var(--bg-input); color: var(--text-primary); outline: none; transition: background .2s, border-color .2s; }
    .links-search:focus { background: var(--bg-input-focus); border-color: var(--accent); }
    .links-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px,1fr)); gap: 1rem; }
    .link-card { background: var(--bg-card); border-radius: 12px; padding: 1.1rem 1rem; box-shadow: 0 3px 12px var(--shadow); border: 1px solid var(--border); display: flex; align-items: center; gap: .8rem; position: relative; transition: transform .2s, box-shadow .2s; }
    .link-card:hover { transform: translateY(-4px); box-shadow: 0 8px 20px var(--shadow); }
    .link-favicon { width: 32px; height: 32px; border-radius: 8px; background: var(--bg-input); display: flex; align-items: center; justify-content: center; font-size: 1.1rem; flex-shrink: 0; overflow: hidden; }
    .link-favicon img { width: 100%; height: 100%; object-fit: cover; }
    .link-info { flex: 1; overflow: hidden; }
    .link-name { font-size: 1rem; font-weight: 600; color: var(--text-primary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .link-url  { font-size: .75rem; color: var(--text-muted); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .link-open { color: var(--accent); text-decoration: none; font-size: 1.3rem; flex-shrink: 0; transition: transform .15s; }
    .link-open:hover { transform: scale(1.2); }
    .link-del { position: absolute; top: .5rem; right: .5rem; background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: .8rem; transition: color .2s; }
    .link-del:hover { color: #e74c3c; }

    /* ================================================================
      CALCULATOR TAB
    ================================================================ */
    .calc-page { flex: 1; display: flex; align-items: flex-start; justify-content: center; padding: 2rem 1rem; }
    .calculator { background: var(--bg-card); border-radius: 20px; padding: 1.5rem; width: 320px; box-shadow: 0 8px 32px var(--shadow); border: 1px solid var(--border); }
    .calc-display { background: var(--bg-input); border-radius: 12px; padding: 1.2rem 1.4rem; margin-bottom: 1.2rem; text-align: right; min-height: 90px; display: flex; flex-direction: column; justify-content: flex-end; gap: .2rem; }
    .calc-history { font-size: .85rem; color: var(--text-muted); min-height: 1.2em; word-break: break-all; }
    .calc-current { font-size: 2.2rem; font-weight: 700; word-break: break-all; color: var(--text-primary); }
    .calc-grid { display: grid; grid-template-columns: repeat(4,1fr); gap: .7rem; }
    .calc-btn { padding: 1rem 0; font-size: 1.2rem; font-family: 'Fredoka', sans-serif; background: var(--bg-btn); border: 1px solid var(--border); border-radius: 12px; color: var(--text-primary); cursor: pointer; transition: background .15s, transform .1s; }
    .calc-btn:hover  { background: var(--bg-btn-hover); }
    .calc-btn:active { transform: scale(.93); }
    .calc-btn.op     { background: var(--bg-input); color: var(--accent); font-weight: 700; }
    .calc-btn.op:hover { background: var(--accent-dim); }
    .calc-btn.eq     { background: var(--accent); color: #fff; font-weight: 700; }
    .calc-btn.eq:hover { opacity: .85; }
    .calc-btn.clear  { background: rgba(231,76,60,.15); color: #e74c3c; }
    .calc-btn.clear:hover { background: rgba(231,76,60,.3); }
    .calc-btn.wide   { grid-column: span 2; }

    /* ================================================================
      SHARED COMPONENTS
    ================================================================ */
    /* Edit-note modal */
    .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,.65); z-index: 100; align-items: center; justify-content: center; }
    .modal-overlay.open { display: flex; }
    .modal { background: var(--bg-card); border-radius: 16px; padding: 2rem; width: 90%; max-width: 480px; display: flex; flex-direction: column; gap: 1rem; box-shadow: 0 8px 30px rgba(0,0,0,.6); }
    .modal h3 { margin: 0; font-size: 1.4rem; }
    .modal input, .modal textarea, .modal select { padding: .75rem 1rem; font-size: .95rem; font-family: 'Fredoka', sans-serif; border: 2px solid transparent; border-radius: 8px; background: var(--bg-input); color: var(--text-primary); outline: none; width: 100%; transition: background .2s, border-color .2s; }
    .modal input:focus, .modal textarea:focus, .modal select:focus { background: var(--bg-input-focus); border-color: var(--accent); }
    .modal textarea { min-height: 120px; resize: vertical; }
    .modal-btns { display: flex; gap: .8rem; justify-content: flex-end; }
    .modal-btns button { padding: .65rem 1.3rem; font-size: .95rem; font-family: 'Fredoka', sans-serif; border: none; border-radius: 8px; cursor: pointer; transition: background .2s; }
    .btn-save-modal   { background: var(--accent); color: #fff; }
    .btn-save-modal:hover   { opacity: .85; }
    .btn-cancel-modal { background: var(--bg-btn); color: var(--text-muted); }
    .btn-cancel-modal:hover { background: var(--bg-btn-hover); }

    /* Toast popup */
    .toast { position: fixed; bottom: 1.5rem; left: 50%; transform: translateX(-50%) translateY(80px); background: var(--bg-card); color: var(--text-primary); padding: .7rem 1.6rem; border-radius: 30px; box-shadow: 0 6px 20px rgba(0,0,0,.4); font-size: .95rem; z-index: 200; border: 1px solid var(--border); transition: transform .3s ease; pointer-events: none; }
    .toast.show { transform: translateX(-50%) translateY(0); }

    /* Footer */
    footer { background: var(--bg-surface); text-align: center; padding: .9rem; font-size: .85rem; color: var(--text-muted); margin-top: auto; border-top: 1px solid var(--border); }
    footer a { color: var(--accent); text-decoration: none; }
    footer a:hover { text-decoration: underline; }

    /* Responsive */
    @media (max-width: 700px) {
      .notes-page    { flex-direction: column; }
      .compose-panel { width: 100%; }
      header         { font-size: 1.8rem; padding: 1rem; }
      .clock-display { font-size: 4rem; }
      .music-wrap    { min-width: 100%; }
    }

  </style>
</head>
<body>

<!-- ================================================================
  HEADER
================================================================ -->
<header>
  <div style="width:80px"></div>
  <div class="header-title">Soups Gallery</div>
  <button class="theme-toggle" id="theme-toggle" title="Toggle dark / light mode">&#127769;</button>
</header>



<!-- ================================================================
  NAV TABS
  To add a new tab:
    1. Copy a <button> here (give it id="tab-yourname")
    2. Add a matching <div class="page" id="page-yourname"> below
================================================================ -->
<nav class="nav-tabs" id="nav-tabs">
  <button class="nav-tab active" id="tab-games"  onclick="switchPage('games')">&#127918; Games</button>
  <button class="nav-tab"        id="tab-notes"  onclick="switchPage('notes')">&#128221; Notes</button>
  <button class="nav-tab"        id="tab-todo"   onclick="switchPage('todo')">&#9989; To-Do</button>
  <button class="nav-tab"        id="tab-timer"  onclick="switchPage('timer')">&#9201; Timer</button>
  <button class="nav-tab"        id="tab-links"  onclick="switchPage('links')">&#128279; Links</button>
  <button class="nav-tab"        id="tab-calc"   onclick="switchPage('calc')">&#129518; Calc</button>
</nav>

<!-- ================================================================
  PASSWORD GATE
================================================================ -->
<div class="password-section" id="password-section">
  <h2>Welcome back &#128075;</h2>
  <p>Enter your password to continue</p>
  <input type="password" id="password-input" placeholder="Password">
  <button class="pw-btn" id="submit-btn">Enter</button>
  <div class="error-message" id="error-message">Wrong password. Try again.</div>
</div>

<!-- ================================================================
  PAGE: GAMES
================================================================ -->
<div class="page" id="page-games">
  <!-- Recently-visited row — hidden until at least one game is clicked -->
  <div class="recently-section" id="recently-section" style="display:none">
    <h3>&#9889; Recently Visited</h3>
    <div class="recent-strip" id="recent-strip"></div>
    <hr class="games-divider">
  </div>
  <!-- Cards are built from the SITES array in JavaScript -->
  <div class="game-container" id="game-container"></div>
</div>

<!-- ================================================================
  PAGE: NOTES
================================================================ -->
<div class="page" id="page-notes">
  <div class="notes-page">

    <!-- Left column: compose a new note -->
    <div class="compose-panel">
      <h2>New Note</h2>
      <input type="text" id="note-title" placeholder="Title&#8230;" maxlength="80">
      <textarea id="note-body" placeholder="Write your note&#8230; (Ctrl+Enter to save)"></textarea>
      <select id="note-tag">
        <option value="">&#8212; No tag &#8212;</option>
        <option value="school">School</option>
        <option value="ideas">Ideas</option>
        <option value="reminders">Reminders</option>
        <option value="other">Other</option>
      </select>
      <div class="colour-row" id="colour-row"><span>Colour:</span></div>
      <button class="notes-save-btn" id="notes-save-btn">+ Save Note</button>
    </div>

    <!-- Right column: saved notes grid -->
    <div class="notes-panel">
      <div class="notes-header-row">
        <h2>Saved Notes</h2>
        <div class="notes-controls">
          <input type="text" class="search-input" id="search-input" placeholder="Search&#8230;">
          <select class="filter-select" id="filter-tag">
            <option value="">All tags</option>
            <option value="school">School</option>
            <option value="ideas">Ideas</option>
            <option value="reminders">Reminders</option>
            <option value="other">Other</option>
          </select>
        </div>
      </div>
      <div class="notes-grid" id="notes-grid"></div>
      <p class="empty-state" id="empty-state">No notes yet. Create one!</p>
    </div>

  </div>
</div>

<!-- ================================================================
  PAGE: TO-DO
================================================================ -->
<div class="page" id="page-todo">
  <div class="todo-page">
    <h2 style="margin:0;font-size:1.5rem;color:var(--text-secondary)">To-Do List</h2>
    <div class="todo-add-row">
      <input type="text" id="todo-input" placeholder="Add a task&#8230; (Enter to add)">
      <select id="todo-priority">
        <option value="medium">Medium</option>
        <option value="high">High</option>
        <option value="low">Low</option>
      </select>
      <button class="todo-add-btn" id="todo-add-btn">+ Add</button>
    </div>
    <div class="todo-filters">
      <button class="todo-filter-btn active" data-filter="all">All</button>
      <button class="todo-filter-btn" data-filter="active">Active</button>
      <button class="todo-filter-btn" data-filter="done">Done</button>
      <button class="todo-filter-btn" data-filter="high">High</button>
      <button class="todo-filter-btn" data-filter="medium">Medium</button>
      <button class="todo-filter-btn" data-filter="low">Low</button>
    </div>
    <div class="todo-list" id="todo-list"></div>
    <p class="empty-state" id="todo-empty" style="display:none">Nothing here! Add a task above.</p>
    <button class="todo-clear-btn" id="todo-clear-btn">Clear completed</button>
  </div>
</div>

<!-- ================================================================
  PAGE: TIMER
================================================================ -->
<div class="page" id="page-timer">
  <div class="timer-page">
    <div class="timer-mode-tabs">
      <button class="timer-mode-tab active" id="tab-pomodoro"  onclick="setTimerMode('pomodoro')">Pomodoro</button>
      <button class="timer-mode-tab"        id="tab-stopwatch" onclick="setTimerMode('stopwatch')">Stopwatch</button>
    </div>
    <!-- SVG ring progress (r=120, circumference=753.98) -->
    <div class="progress-ring-wrap">
      <svg class="progress-ring" width="280" height="280" viewBox="0 0 280 280">
        <circle class="ring-bg"   cx="140" cy="140" r="120"/>
        <circle class="ring-fill" cx="140" cy="140" r="120"
          id="ring-fill" stroke-dasharray="753.98" stroke-dashoffset="0"/>
      </svg>
      <div class="clock-display" id="clock-display">25:00</div>
    </div>
    <div class="timer-controls">
      <button class="timer-btn primary" id="timer-start-btn" onclick="timerToggle()">&#9654; Start</button>
      <button class="timer-btn" onclick="timerReset()">&#8634; Reset</button>
    </div>
    <div class="pomodoro-presets" id="pomodoro-presets">
      <button class="preset-btn" onclick="setPomodoro(25,0)">Focus 25m</button>
      <button class="preset-btn" onclick="setPomodoro(5,0)">Break 5m</button>
      <button class="preset-btn" onclick="setPomodoro(15,0)">Break 15m</button>
      <button class="preset-btn" onclick="setPomodoro(45,0)">Deep work 45m</button>
    </div>
    <div class="session-counter" id="session-counter">Sessions today: 0</div>
  </div>
</div>

<!-- ================================================================
  PAGE: LINKS
================================================================ -->
<div class="page" id="page-links">
  <div class="links-page">
    <h2 style="margin:0;font-size:1.5rem;color:var(--text-secondary)">Link Vault</h2>
    <div class="links-add-form">
      <input type="text" id="link-name-input" placeholder="Name (e.g. Google)">
      <input type="url"  id="link-url-input"  placeholder="URL (e.g. https://google.com)">
      <button class="links-add-btn" id="links-add-btn">+ Add Link</button>
    </div>
    <div class="links-header-row">
      <h2>Saved Links</h2>
      <input type="text" class="links-search" id="links-search" placeholder="Search&#8230;">
    </div>
    <div class="links-grid" id="links-grid"></div>
    <p class="empty-state" id="links-empty">No links saved yet.</p>
  </div>
</div>

<!-- ================================================================
  PAGE: CALCULATOR
================================================================ -->
<div class="page" id="page-calc">
  <div class="calc-page">
    <div class="calculator">
      <div class="calc-display">
        <div class="calc-history" id="calc-history"></div>
        <div class="calc-current" id="calc-current">0</div>
      </div>
      <div class="calc-grid">
        <button class="calc-btn clear" onclick="calcClear()">C</button>
        <button class="calc-btn op"    onclick="calcSign()">+/&#8722;</button>
        <button class="calc-btn op"    onclick="calcPercent()">%</button>
        <button class="calc-btn op"    onclick="calcOp('div')">&#247;</button>
        <button class="calc-btn"       onclick="calcNum('7')">7</button>
        <button class="calc-btn"       onclick="calcNum('8')">8</button>
        <button class="calc-btn"       onclick="calcNum('9')">9</button>
        <button class="calc-btn op"    onclick="calcOp('mul')">&#215;</button>
        <button class="calc-btn"       onclick="calcNum('4')">4</button>
        <button class="calc-btn"       onclick="calcNum('5')">5</button>
        <button class="calc-btn"       onclick="calcNum('6')">6</button>
        <button class="calc-btn op"    onclick="calcOp('sub')">&#8722;</button>
        <button class="calc-btn"       onclick="calcNum('1')">1</button>
        <button class="calc-btn"       onclick="calcNum('2')">2</button>
        <button class="calc-btn"       onclick="calcNum('3')">3</button>
        <button class="calc-btn op"    onclick="calcOp('add')">+</button>
        <button class="calc-btn wide"  onclick="calcNum('0')">0</button>
        <button class="calc-btn"       onclick="calcDot()">.</button>
        <button class="calc-btn eq"    onclick="calcEquals()">=</button>
      </div>
    </div>
  </div>
</div>

<!-- ================================================================
  EDIT-NOTE MODAL
================================================================ -->
<div class="modal-overlay" id="modal-overlay">
  <div class="modal">
    <h3>Edit Note</h3>
    <input type="text" id="modal-title" placeholder="Title&#8230;" maxlength="80">
    <textarea id="modal-body" placeholder="Note&#8230;"></textarea>
    <select id="modal-tag">
      <option value="">&#8212; No tag &#8212;</option>
      <option value="school">School</option>
      <option value="ideas">Ideas</option>
      <option value="reminders">Reminders</option>
      <option value="other">Other</option>
    </select>
    <div class="modal-btns">
      <button class="btn-cancel-modal" id="modal-cancel">Cancel</button>
      <button class="btn-save-modal"   id="modal-save">Save Changes</button>
    </div>
  </div>
</div>

<!-- Toast notification -->
<div class="toast" id="toast"></div>

<!-- ================================================================
  FOOTER
  Edit the text here to change the footer message.
================================================================ -->
<footer>
  Special thanks to my friend
  <a href="https://red404441.com" target="_blank" rel="noopener noreferrer">red404441</a>
  &#8212; go check out his website! &#127881;
</footer>

<!-- Pocket Bird Easter egg widget -->
<script src="https://cdn.jsdelivr.net/gh/IdreesInc/Pocket-Bird@main/dist/web/birb.embed.js"></script>

<!-- ================================================================
  JAVASCRIPT
================================================================ -->
<script>

  /* ================================================================
    EASY-EDIT CONFIG
    Change things here without touching the rest of the code.
  ================================================================ */

  // Unlock password
  var PASSWORD = "2244";

  // Games list — add / remove { name, url } objects to edit the grid
  var SITES = [
    { name: "Veck",                   url: "https://veck.io/" },
    { name: "Neal.fun",               url: "https://neal.fun/" },
    { name: "Eaglercraft",            url: "https://eaglercraft.q13x.com/1.8.8/js/?retina=true" },
    { name: "Slow Roads",             url: "https://slowroads.io/" },
    { name: "Game Snacks",            url: "https://gamesnacks.com/" },
    { name: "Polytrack",              url: "https://www.kodub.com/apps/polytrack" },
    { name: "Cat Mario",              url: "https://catmario.eu/" },
    { name: "Among Us",               url: "https://scratch.mit.edu/projects/523967150/" },
    { name: "PIXEL VALLEY Online",    url: "https://scratch.mit.edu/projects/551905179/" },
    { name: "Getting Over It Online", url: "https://scratch.mit.edu/projects/390983761/" },
    { name: "Downgrade2 Online",      url: "https://turbowarp.org/1115559391/fullscreen?fps=60&clones=Infinity&limitless&hqpen&size=640x360" },
    { name: "portal (scratch)",       url: "https://turbowarp.org/1165334435/fullscreen" },
  ];

  // Note card background colours (hex) shown in the colour picker
  var COLOURS = [
    "#f9e08a",  // yellow
    "#a8e6a3",  // green
    "#a8d4f5",  // blue
    "#f5a8c0",  // pink
    "#f5c6a8",  // orange
    "#d1a8f5",  // purple
    "#e0e0e0",  // white/grey
  ];

  /* ================================================================
    TOAST  — small popup notification
  ================================================================ */
  var _toastTimer;
  function showToast(msg) {
    var t = document.getElementById('toast');
    t.textContent = msg;
    t.classList.add('show');
    clearTimeout(_toastTimer);
    _toastTimer = setTimeout(function() { t.classList.remove('show'); }, 2200);
  }

  /* ================================================================
    THEME  — dark / light, persisted to localStorage
  ================================================================ */
  var currentTheme = localStorage.getItem('soups_theme') || 'dark';
  document.documentElement.setAttribute('data-theme', currentTheme);
  document.getElementById('theme-toggle').textContent = currentTheme === 'dark' ? '&#127769;' : '&#9728;&#65039;';

  document.getElementById('theme-toggle').addEventListener('click', function() {
    currentTheme = currentTheme === 'dark' ? 'light' : 'dark';
    document.documentElement.setAttribute('data-theme', currentTheme);
    this.textContent = currentTheme === 'dark' ? '&#127769;' : '&#9728;&#65039;';
    localStorage.setItem('soups_theme', currentTheme);
  });



  /* ================================================================
    PAGE SWITCHING
  ================================================================ */
  function switchPage(name) {
    document.querySelectorAll('.page').forEach(function(p) { p.classList.remove('active'); });
    document.querySelectorAll('.nav-tab').forEach(function(t) { t.classList.remove('active'); });
    document.getElementById('page-' + name).classList.add('active');
    document.getElementById('tab-' + name).classList.add('active');
  }

  /* ================================================================
    PASSWORD GATE
  ================================================================ */
  function checkPassword() {
    var val = document.getElementById('password-input').value;
    if (val === PASSWORD) {
      document.getElementById('password-section').style.display = 'none';
      document.getElementById('nav-tabs').classList.add('visible');
      switchPage('games');
      renderRecentGames();
    } else {
      document.getElementById('error-message').style.display = 'block';
      document.getElementById('password-input').value = '';
      document.getElementById('password-input').focus();
    }
  }
  document.getElementById('submit-btn').addEventListener('click', checkPassword);
  document.getElementById('password-input').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') checkPassword();
  });

  /* ================================================================
    GAMES — build cards from the SITES array above
  ================================================================ */
  (function buildGameCards() {
    var container = document.getElementById('game-container');
    SITES.forEach(function(site) {
      var a = document.createElement('a');
      a.className   = 'game-card';
      a.href        = site.url;
      a.target      = '_blank';
      a.rel         = 'noopener noreferrer';
      a.innerHTML   = '<h3>' + site.name + '</h3>';
      a.addEventListener('click', function() { addRecentGame(site); });
      container.appendChild(a);
    });
  })();

  /* ================================================================
    RECENT GAMES — tracks last 4 visited games
  ================================================================ */
  var RECENT_GAMES_KEY = 'soups_recent_v1';

  function getRecentGames() {
    try { return JSON.parse(localStorage.getItem(RECENT_GAMES_KEY)) || []; } catch(e) { return []; }
  }
  function addRecentGame(site) {
    var arr = getRecentGames().filter(function(s) { return s.url !== site.url; });
    arr.unshift(site);
    if (arr.length > 4) arr = arr.slice(0, 4);
    localStorage.setItem(RECENT_GAMES_KEY, JSON.stringify(arr));
  }
  function renderRecentGames() {
    var arr   = getRecentGames();
    var sec   = document.getElementById('recently-section');
    var strip = document.getElementById('recent-strip');
    if (!arr.length) { sec.style.display = 'none'; return; }
    sec.style.display = 'block';
    strip.innerHTML   = '';
    arr.forEach(function(site) {
      var a     = document.createElement('a');
      a.className = 'recent-chip';
      a.href      = site.url;
      a.target    = '_blank';
      a.rel       = 'noopener noreferrer';
      a.textContent = site.name;
      a.addEventListener('click', function() { addRecentGame(site); });
      strip.appendChild(a);
    });
  }

  /* ================================================================
    NOTES — colour picker
  ================================================================ */
  var selectedColour = COLOURS[0];
  (function buildColourPicker() {
    var row = document.getElementById('colour-row');
    COLOURS.forEach(function(hex) {
      var dot = document.createElement('div');
      dot.className        = 'colour-dot' + (hex === selectedColour ? ' selected' : '');
      dot.style.backgroundColor = hex;
      dot.addEventListener('click', function() {
        document.querySelectorAll('.colour-dot').forEach(function(d) { d.classList.remove('selected'); });
        dot.classList.add('selected');
        selectedColour = hex;
      });
      row.appendChild(dot);
    });
  })();

  /* ================================================================
    NOTES — storage helpers
  ================================================================ */
  var NOTES_KEY = 'soups_notes_v2';
  function loadNotes() { try { return JSON.parse(localStorage.getItem(NOTES_KEY)) || []; } catch(e) { return []; } }
  function saveNotes(n) { localStorage.setItem(NOTES_KEY, JSON.stringify(n)); }

  /* ================================================================
    NOTES — render grid
  ================================================================ */
  function renderNotes() {
    var search    = document.getElementById('search-input').value.toLowerCase();
    var tagFilter = document.getElementById('filter-tag').value;
    var notes     = loadNotes();
    var grid      = document.getElementById('notes-grid');
    var empty     = document.getElementById('empty-state');
    grid.innerHTML = '';

    var filtered = notes.filter(function(n) {
      return (!search    || (n.title + ' ' + n.body).toLowerCase().indexOf(search) >= 0)
          && (!tagFilter || n.tag === tagFilter);
    });

    if (!filtered.length) {
      empty.style.display = 'block';
      empty.textContent   = (search || tagFilter) ? 'No notes match your filters.' : 'No notes yet. Create one!';
      return;
    }
    empty.style.display = 'none';

    // Pinned notes sort to the top
    filtered.sort(function(a, b) { return (b.pinned ? 1 : 0) - (a.pinned ? 1 : 0) || b.created - a.created; });

    filtered.forEach(function(note) {
      var card = document.createElement('div');
      card.className            = 'note-card' + (note.pinned ? ' pinned' : '');
      card.style.backgroundColor = note.colour || COLOURS[0];

      // Pin / Delete buttons
      var actions = document.createElement('div');
      actions.className = 'card-actions';

      var pinBtn = document.createElement('button');
      pinBtn.textContent = note.pinned ? 'unpin' : 'pin';
      pinBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        saveNotes(loadNotes().map(function(n) {
          return n.id === note.id ? Object.assign({}, n, { pinned: !n.pinned }) : n;
        }));
        renderNotes();
      });

      var delBtn = document.createElement('button');
      delBtn.textContent = 'x';
      delBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        saveNotes(loadNotes().filter(function(n) { return n.id !== note.id; }));
        renderNotes();
        showToast('Note deleted');
      });

      actions.appendChild(pinBtn);
      actions.appendChild(delBtn);

      var titleEl = document.createElement('div'); titleEl.className = 'card-title'; titleEl.textContent = note.title || '(no title)';
      var bodyEl  = document.createElement('div'); bodyEl.className  = 'card-body';  bodyEl.textContent  = note.body;
      var dateEl  = document.createElement('div'); dateEl.className  = 'card-date';
      dateEl.textContent = new Date(note.created).toLocaleDateString(undefined, { month: 'short', day: 'numeric', year: 'numeric' });

      card.appendChild(actions);
      card.appendChild(titleEl);
      card.appendChild(bodyEl);
      if (note.tag) {
        var tagEl = document.createElement('div'); tagEl.className = 'card-tag'; tagEl.textContent = note.tag;
        card.appendChild(tagEl);
      }
      card.appendChild(dateEl);
      card.addEventListener('click', function() { openEditModal(note.id); });
      grid.appendChild(card);
    });
  }

  // Save a new note
  document.getElementById('notes-save-btn').addEventListener('click', function() {
    var title = document.getElementById('note-title').value;
    var body  = document.getElementById('note-body').value;
    if (!title.trim() && !body.trim()) return;
    var notes = loadNotes();
    notes.push({ id: Date.now().toString(), title: title.trim(), body: body.trim(), colour: selectedColour, tag: document.getElementById('note-tag').value, created: Date.now(), pinned: false });
    saveNotes(notes); renderNotes();
    document.getElementById('note-title').value = '';
    document.getElementById('note-body').value  = '';
    document.getElementById('note-tag').value   = '';
    showToast('Note saved');
  });

  // Ctrl+Enter shortcut inside the textarea
  document.getElementById('note-body').addEventListener('keydown', function(e) {
    if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) document.getElementById('notes-save-btn').click();
  });

  document.getElementById('search-input').addEventListener('input',  renderNotes);
  document.getElementById('filter-tag').addEventListener('change',   renderNotes);
  renderNotes();

  /* ================================================================
    NOTES — edit modal
  ================================================================ */
  var editingNoteId = null;

  function openEditModal(id) {
    var note = loadNotes().find(function(n) { return n.id === id; });
    if (!note) return;
    editingNoteId = id;
    document.getElementById('modal-title').value = note.title;
    document.getElementById('modal-body').value  = note.body;
    document.getElementById('modal-tag').value   = note.tag || '';
    document.getElementById('modal-overlay').classList.add('open');
  }

  document.getElementById('modal-cancel').addEventListener('click', function() {
    document.getElementById('modal-overlay').classList.remove('open'); editingNoteId = null;
  });
  document.getElementById('modal-overlay').addEventListener('click', function(e) {
    if (e.target === this) { this.classList.remove('open'); editingNoteId = null; }
  });
  document.getElementById('modal-save').addEventListener('click', function() {
    if (!editingNoteId) return;
    saveNotes(loadNotes().map(function(n) {
      if (n.id !== editingNoteId) return n;
      return Object.assign({}, n, { title: document.getElementById('modal-title').value.trim(), body: document.getElementById('modal-body').value.trim(), tag: document.getElementById('modal-tag').value });
    }));
    renderNotes();
    document.getElementById('modal-overlay').classList.remove('open'); editingNoteId = null;
    showToast('Note updated');
  });

  /* ================================================================
    TO-DO
  ================================================================ */
  var TODO_KEY   = 'soups_todos_v1';
  var todoFilter = 'all';

  function loadTodos() { try { return JSON.parse(localStorage.getItem(TODO_KEY)) || []; } catch(e) { return []; } }
  function saveTodos(t) { localStorage.setItem(TODO_KEY, JSON.stringify(t)); }

  function renderTodos() {
    var todos    = loadTodos();
    var list     = document.getElementById('todo-list');
    var empty    = document.getElementById('todo-empty');
    list.innerHTML = '';

    var filtered = todos.filter(function(t) {
      if (todoFilter === 'active') return !t.done;
      if (todoFilter === 'done')   return  t.done;
      if (['high','medium','low'].indexOf(todoFilter) >= 0) return t.priority === todoFilter;
      return true;
    });
    filtered.sort(function(a, b) { return (a.done ? 1 : 0) - (b.done ? 1 : 0); });

    if (!filtered.length) { empty.style.display = 'block'; return; }
    empty.style.display = 'none';

    filtered.forEach(function(todo) {
      var item = document.createElement('div');
      item.className = 'todo-item' + (todo.done ? ' done' : '');

      var cb = document.createElement('div');
      cb.className  = 'todo-checkbox' + (todo.done ? ' checked' : '');
      cb.textContent = todo.done ? 'v' : '';
      cb.addEventListener('click', function() {
        saveTodos(loadTodos().map(function(t) { return t.id === todo.id ? Object.assign({}, t, { done: !t.done }) : t; }));
        renderTodos();
      });

      var tx = document.createElement('div'); tx.className = 'todo-text'; tx.textContent = todo.text;

      var pr = document.createElement('div'); pr.className = 'todo-priority ' + todo.priority;
      pr.textContent = todo.priority.charAt(0).toUpperCase() + todo.priority.slice(1);

      var dl = document.createElement('button'); dl.className = 'todo-del'; dl.textContent = 'del';
      dl.addEventListener('click', function() { saveTodos(loadTodos().filter(function(t) { return t.id !== todo.id; })); renderTodos(); });

      item.appendChild(cb); item.appendChild(tx); item.appendChild(pr); item.appendChild(dl);
      list.appendChild(item);
    });
  }

  function addTodo() {
    var inp = document.getElementById('todo-input');
    var txt = inp.value.trim();
    if (!txt) return;
    loadTodos().concat([]);  // just a hint
    var todos = loadTodos();
    todos.push({ id: Date.now().toString(), text: txt, priority: document.getElementById('todo-priority').value, done: false, created: Date.now() });
    saveTodos(todos); inp.value = ''; renderTodos(); showToast('Task added');
  }

  document.getElementById('todo-add-btn').addEventListener('click', addTodo);
  document.getElementById('todo-input').addEventListener('keypress', function(e) { if (e.key === 'Enter') addTodo(); });
  document.getElementById('todo-clear-btn').addEventListener('click', function() {
    saveTodos(loadTodos().filter(function(t) { return !t.done; })); renderTodos(); showToast('Cleared');
  });
  document.querySelectorAll('.todo-filter-btn').forEach(function(btn) {
    btn.addEventListener('click', function() {
      document.querySelectorAll('.todo-filter-btn').forEach(function(b) { b.classList.remove('active'); });
      btn.classList.add('active'); todoFilter = btn.dataset.filter; renderTodos();
    });
  });
  renderTodos();

  /* ================================================================
    TIMER — Pomodoro + Stopwatch
  ================================================================ */
  var timerMode      = 'pomodoro';
  var timerRunning   = false;
  var timerInterval  = null;
  var timerTotal     = 25 * 60;   // seconds
  var timerRemaining = 25 * 60;
  var stopwatchMs    = 0;
  var stopwatchStart = 0;

  // Session counter resets each calendar day
  var sessionsToday = parseInt(localStorage.getItem('soups_sessions') || '0');
  var todayStr = new Date().toDateString();
  if (localStorage.getItem('soups_session_date') !== todayStr) {
    sessionsToday = 0;
    localStorage.setItem('soups_sessions', '0');
    localStorage.setItem('soups_session_date', todayStr);
  }
  function updateSessionCounter() {
    document.getElementById('session-counter').textContent = 'Sessions today: ' + sessionsToday;
  }
  updateSessionCounter();

  var RING_CIRC = 2 * Math.PI * 120;   // circumference of r=120
  function updateRing(fraction) { document.getElementById('ring-fill').style.strokeDashoffset = RING_CIRC * (1 - fraction); }

  function fmtTime(s) { var m = Math.floor(s / 60), sec = s % 60; return (m < 10 ? '0' : '') + m + ':' + (sec < 10 ? '0' : '') + sec; }
  function fmtStopwatch(ms) {
    var cs = Math.floor(ms / 10) % 100, s = Math.floor(ms / 1000) % 60, m = Math.floor(ms / 60000) % 60, h = Math.floor(ms / 3600000);
    return (h > 0 ? (h < 10 ? '0' : '') + h + ':' : '') + (m < 10 ? '0' : '') + m + ':' + (s < 10 ? '0' : '') + s + '.' + (cs < 10 ? '0' : '') + cs;
  }

  function setTimerMode(mode) {
    timerMode = mode; timerStop();
    document.getElementById('tab-pomodoro').classList.toggle('active',  mode === 'pomodoro');
    document.getElementById('tab-stopwatch').classList.toggle('active', mode === 'stopwatch');
    document.getElementById('pomodoro-presets').style.display = mode === 'pomodoro' ? 'flex'  : 'none';
    document.getElementById('session-counter').style.display  = mode === 'pomodoro' ? 'block' : 'none';
    var clock = document.getElementById('clock-display'); clock.classList.remove('warning', 'done');
    if (mode === 'pomodoro') { timerRemaining = timerTotal; clock.textContent = fmtTime(timerRemaining); updateRing(1); }
    else                     { stopwatchMs = 0; clock.textContent = fmtStopwatch(0); updateRing(0); }
  }

  // Change the pomodoro duration (called by preset buttons)
  function setPomodoro(min, sec) {
    timerStop(); timerTotal = min * 60 + sec; timerRemaining = timerTotal;
    var c = document.getElementById('clock-display'); c.classList.remove('warning', 'done');
    c.textContent = fmtTime(timerRemaining); updateRing(1);
  }

  function timerToggle() {
    if (timerRunning) { timerStop(); return; }
    timerRunning = true;
    document.getElementById('timer-start-btn').textContent = 'Pause';
    if (timerMode === 'pomodoro') {
      timerInterval = setInterval(function() {
        timerRemaining--;
        var clock = document.getElementById('clock-display');
        clock.textContent = fmtTime(timerRemaining);
        updateRing(timerRemaining / timerTotal);
        if (timerRemaining <= 60) clock.classList.add('warning');
        if (timerRemaining <= 0) {
          clearInterval(timerInterval); timerRunning = false;
          clock.classList.remove('warning'); clock.classList.add('done');
          document.getElementById('timer-start-btn').textContent = 'Start';
          sessionsToday++;
          localStorage.setItem('soups_sessions', sessionsToday);
          localStorage.setItem('soups_session_date', todayStr);
          updateSessionCounter(); showToast('Session complete!');
        }
      }, 1000);
    } else {
      stopwatchStart = Date.now() - stopwatchMs;
      timerInterval = setInterval(function() {
        stopwatchMs = Date.now() - stopwatchStart;
        document.getElementById('clock-display').textContent = fmtStopwatch(stopwatchMs);
      }, 10);
    }
  }

  function timerStop() {
    timerRunning = false; clearInterval(timerInterval);
    document.getElementById('timer-start-btn').textContent = 'Start';
  }

  function timerReset() {
    timerStop();
    var c = document.getElementById('clock-display'); c.classList.remove('warning', 'done');
    if (timerMode === 'pomodoro') { timerRemaining = timerTotal; c.textContent = fmtTime(timerRemaining); updateRing(1); }
    else { stopwatchMs = 0; c.textContent = fmtStopwatch(0); updateRing(0); }
  }

  /* ================================================================
    LINKS
  ================================================================ */
  var LINKS_KEY = 'soups_links_v1';
  function loadLinks() { try { return JSON.parse(localStorage.getItem(LINKS_KEY)) || []; } catch(e) { return []; } }
  function saveLinks(l) { localStorage.setItem(LINKS_KEY, JSON.stringify(l)); }

  function renderLinks(filter) {
    filter = (filter || '').toLowerCase();
    var links = loadLinks();
    var grid  = document.getElementById('links-grid');
    var empty = document.getElementById('links-empty');
    grid.innerHTML = '';

    var filtered = filter
      ? links.filter(function(l) { return l.name.toLowerCase().indexOf(filter) >= 0 || l.url.toLowerCase().indexOf(filter) >= 0; })
      : links;

    if (!filtered.length) { empty.style.display = 'block'; return; }
    empty.style.display = 'none';

    filtered.slice().reverse().forEach(function(link) {
      var card = document.createElement('div'); card.className = 'link-card';

      // Favicon via Google's favicon service
      var fav = document.createElement('div'); fav.className = 'link-favicon';
      try {
        var img = document.createElement('img');
        img.src = 'https://www.google.com/s2/favicons?domain=' + new URL(link.url).hostname + '&sz=32';
        img.onerror = function() { fav.textContent = 'o'; };
        fav.appendChild(img);
      } catch(e) { fav.textContent = 'o'; }

      var info = document.createElement('div'); info.className = 'link-info';
      var nm   = document.createElement('div'); nm.className   = 'link-name'; nm.textContent = link.name;
      var ur   = document.createElement('div'); ur.className   = 'link-url';  ur.textContent = link.url;
      info.appendChild(nm); info.appendChild(ur);

      var op = document.createElement('a'); op.className = 'link-open'; op.href = link.url; op.target = '_blank'; op.rel = 'noopener noreferrer'; op.textContent = '->';
      var dl = document.createElement('button'); dl.className = 'link-del'; dl.textContent = 'x';
      dl.addEventListener('click', function() {
        saveLinks(loadLinks().filter(function(l) { return l.id !== link.id; }));
        renderLinks(document.getElementById('links-search').value);
        showToast('Link removed');
      });

      card.appendChild(fav); card.appendChild(info); card.appendChild(op); card.appendChild(dl);
      grid.appendChild(card);
    });
  }

  document.getElementById('links-add-btn').addEventListener('click', function() {
    var name = document.getElementById('link-name-input').value.trim();
    var url  = document.getElementById('link-url-input').value.trim();
    if (!name || !url) { showToast('Enter a name and URL'); return; }
    if (!/^https?:\/\//i.test(url)) url = 'https://' + url;
    var links = loadLinks(); links.push({ id: Date.now().toString(), name: name, url: url }); saveLinks(links);
    document.getElementById('link-name-input').value = ''; document.getElementById('link-url-input').value = '';
    renderLinks(); showToast('Link saved');
  });
  document.getElementById('links-search').addEventListener('input',  function() { renderLinks(this.value); });
  document.getElementById('link-url-input').addEventListener('keypress', function(e) { if (e.key === 'Enter') document.getElementById('links-add-btn').click(); });
  renderLinks();

  /* ================================================================
    CALCULATOR
  ================================================================ */
  var calcState = { current: '0', previous: '', operator: null, fresh: false };
  var calcOpLabels = { add: '+', sub: '-', mul: 'x', div: '/' };

  function calcUpdate() {
    document.getElementById('calc-current').textContent = calcState.current;
    document.getElementById('calc-history').textContent = (calcState.previous && calcState.operator)
      ? calcState.previous + ' ' + calcOpLabels[calcState.operator] : '';
  }
  function calcNum(n) {
    if (calcState.fresh) { calcState.current = '0'; calcState.fresh = false; }
    if (calcState.current === '0' && n !== '.') calcState.current = n;
    else if (calcState.current.length < 14) calcState.current += n;
    calcUpdate();
  }
  function calcDot() {
    if (calcState.fresh) { calcState.current = '0'; calcState.fresh = false; }
    if (calcState.current.indexOf('.') < 0) calcState.current += '.';
    calcUpdate();
  }
  function calcOp(op) {
    if (calcState.operator && !calcState.fresh) calcEquals(true);
    calcState.operator = op; calcState.previous = calcState.current; calcState.fresh = true; calcUpdate();
  }
  function calcEquals(chain) {
    if (!calcState.operator || !calcState.previous) return;
    var a = parseFloat(calcState.previous), b = parseFloat(calcState.current), result;
    if (calcState.operator === 'add') result = a + b;
    if (calcState.operator === 'sub') result = a - b;
    if (calcState.operator === 'mul') result = a * b;
    if (calcState.operator === 'div') result = b !== 0 ? a / b : 'Error';
    var res = typeof result === 'number' ? (Number.isInteger(result) ? result.toString() : parseFloat(result.toFixed(10)).toString()) : result;
    calcState.current = res; calcState.operator = chain ? calcState.operator : null;
    calcState.previous = chain ? res : ''; calcState.fresh = !chain; calcUpdate();
  }
  function calcClear()   { calcState = { current: '0', previous: '', operator: null, fresh: false }; calcUpdate(); }
  function calcSign()    { if (calcState.current !== '0') { calcState.current = calcState.current.startsWith('-') ? calcState.current.slice(1) : '-' + calcState.current; calcUpdate(); } }
  function calcPercent() { calcState.current = (parseFloat(calcState.current) / 100).toString(); calcUpdate(); }

  // Keyboard shortcuts — only active when Calculator tab is open
  document.addEventListener('keydown', function(e) {
    if (!document.getElementById('page-calc').classList.contains('active')) return;
    var k = e.key;
    if ('0123456789'.indexOf(k) >= 0) calcNum(k);
    else if (k === '.')  calcDot();
    else if (k === '+')  calcOp('add');
    else if (k === '-')  calcOp('sub');
    else if (k === '*')  calcOp('mul');
    else if (k === '/') { e.preventDefault(); calcOp('div'); }
    else if (k === 'Enter' || k === '=') calcEquals();
    else if (k === 'Backspace') { calcState.current = calcState.current.length > 1 ? calcState.current.slice(0, -1) : '0'; calcUpdate(); }
    else if (k === 'Escape') calcClear();
  });
  calcUpdate();

</script>
</body>
</html>
